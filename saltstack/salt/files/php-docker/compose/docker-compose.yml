{%- set cfg = salt['pillar.get']('proxy_vhosts:'+service_id, {}) -%}
version: '3'

services:
  app:
    container_name: {{ service_id }}-fpm
    image: php:{{ cfg.php.version }}-fpm
    user: {{ cfg.php.user }}
    ports:
      - '{{ cfg.port }}:9000'
    volumes:
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
      - /opt/{{ service_id }}/php.ini:/usr/local/etc/php/conf.d/vhost.ini:ro
      - {{ cfg.root }}/web:/var/www/html
    restart: always
